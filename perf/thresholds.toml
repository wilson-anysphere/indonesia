# Benchmarks listed here are allowed to regress (use sparingly; prefer updating thresholds
# only when the regression is expected/acceptable).
allow_regressions = []

[default]
# Performance is a feature: fail CI when editor-critical benchmarks regress.
#
# Thresholds are expressed as fractional regression (e.g. 0.10 = +10% slower).
p50_regression = 0.10
p95_regression = 0.20

[benchmarks]
# Per-benchmark overrides go here, for example:
# "parsing/large" = { p50_regression = 0.15, p95_regression = 0.30 }

# Full-fidelity parsing (`nova_syntax::parse_java`).
"syntax_parse_java/small" = { p50_regression = 0.15, p95_regression = 0.30 }
"syntax_parse_java/medium" = { p50_regression = 0.15, p95_regression = 0.30 }
"syntax_parse_java/large" = { p50_regression = 0.15, p95_regression = 0.30 }

# Parse + small edit + reparse (simulates typing latency; includes a string splice).
"syntax_parse_java_incremental/small" = { p50_regression = 0.15, p95_regression = 0.30 }
"syntax_parse_java_incremental/medium" = { p50_regression = 0.15, p95_regression = 0.30 }
"syntax_parse_java_incremental/large" = { p50_regression = 0.15, p95_regression = 0.30 }

# Formatter (`nova_format::format_java` + diffing edits).
"format_java/small" = { p50_regression = 0.20, p95_regression = 0.40 }
"format_java/medium" = { p50_regression = 0.20, p95_regression = 0.40 }
"format_java/pathological" = { p50_regression = 0.20, p95_regression = 0.40 }

"format_edits_for_formatting/small" = { p50_regression = 0.20, p95_regression = 0.40 }
"format_edits_for_formatting/medium" = { p50_regression = 0.20, p95_regression = 0.40 }
"format_edits_for_formatting/pathological" = { p50_regression = 0.20, p95_regression = 0.40 }

# Refactorings (semantic organize imports / rename).
"refactor/organize_imports" = { p50_regression = 0.25, p95_regression = 0.50 }
"refactor/rename_method" = { p50_regression = 0.25, p95_regression = 0.50 }

# Classpath indexing (includes local file I/O; allow more noise).
"classpath_index_build/dep_jar" = { p50_regression = 0.40, p95_regression = 0.80 }
"classpath_index_build/multirelease_jar" = { p50_regression = 0.40, p95_regression = 0.80 }
"classpath_index_build/named_module_jmod" = { p50_regression = 0.40, p95_regression = 0.80 }

# IDE completion latency (microbenchmarks; allow a bit more variance than parsing/formatting).
"ide_completion/member" = { p50_regression = 0.25, p95_regression = 0.50 }
"ide_completion/import" = { p50_regression = 0.25, p95_regression = 0.50 }
"ide_completion/type_position" = { p50_regression = 0.25, p95_regression = 0.50 }
"ide_completion/postfix" = { p50_regression = 0.25, p95_regression = 0.50 }

# IDE completion + semantic token critical paths (nova-core/critical_paths).
"ide_completion/member_access" = { p50_regression = 0.25, p95_regression = 0.50 }
"ide_completion/type_prefix" = { p50_regression = 0.25, p95_regression = 0.50 }
"ide_semantic_tokens/medium" = { p50_regression = 0.15, p95_regression = 0.30 }
"ide_semantic_tokens/large" = { p50_regression = 0.20, p95_regression = 0.40 }

# Fuzzy scoring + trigram candidate generation (very hot paths; allow modest CI noise).
"fuzzy_score/short" = { p50_regression = 0.15, p95_regression = 0.30 }
"fuzzy_score/medium" = { p50_regression = 0.15, p95_regression = 0.60 }
"trigram_candidates/query_len_3" = { p50_regression = 0.15, p95_regression = 0.30 }
"trigram_candidates/query_len_4_or_5" = { p50_regression = 0.15, p95_regression = 0.30 }
"trigram_candidates/dense_multi_trigram_intersection" = { p50_regression = 0.20, p95_regression = 0.40 }

# Workspace symbol search (in-memory; some variance from large allocations + sorting).
"symbol_search/prefix_hm/equal" = { p50_regression = 0.20, p95_regression = 0.80 }
"symbol_search/prefix_hm/qualified" = { p50_regression = 0.35, p95_regression = 0.80 }
"symbol_search/prefix_m_many/equal" = { p50_regression = 0.25, p95_regression = 0.80 }
"symbol_search/prefix_m_many/qualified" = { p50_regression = 0.25, p95_regression = 0.80 }
"symbol_search/trigram_map/equal" = { p50_regression = 0.15, p95_regression = 1.20 }
"symbol_search/trigram_map/qualified" = { p50_regression = 0.15, p95_regression = 0.80 }
"symbol_search/trigram_man_many/equal" = { p50_regression = 0.25, p95_regression = 0.80 }
"symbol_search/trigram_man_many/qualified" = { p50_regression = 0.25, p95_regression = 0.80 }
"symbol_search/trigram_hmap_multi/equal" = { p50_regression = 0.25, p95_regression = 0.80 }
"symbol_search/trigram_hmap_multi/qualified" = { p50_regression = 0.25, p95_regression = 0.80 }
"symbol_search/fallback_full_scan_zkm/equal" = { p50_regression = 0.25, p95_regression = 0.50 }
"symbol_search/fallback_full_scan_zkm/qualified" = { p50_regression = 0.25, p95_regression = 0.50 }
"symbol_search_full_scan_many/full_scan_z_many_matches/equal" = { p50_regression = 0.25, p95_regression = 0.80 }
"symbol_search_full_scan_many/full_scan_z_many_matches/qualified" = { p50_regression = 0.25, p95_regression = 0.80 }
