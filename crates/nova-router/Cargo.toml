[package]
name = "nova-router"
version.workspace = true
edition.workspace = true

[features]
tls = [
    "dep:tokio-rustls",
    "dep:rustls",
    "dep:rustls-pemfile",
    "dep:sha2",
    "dep:hex",
]
# Enables Unicode-aware fuzzy matching and trigram preprocessing in `nova-fuzzy`.
unicode = ["nova-fuzzy/unicode"]

[dependencies]
anyhow.workspace = true
thiserror.workspace = true
tokio.workspace = true
tracing.workspace = true
getrandom = "0.2"

nova-cache = { path = "../nova-cache" }
nova-bugreport = { path = "../nova-bugreport" }
nova-config = { path = "../nova-config" }
nova-core = { path = "../nova-core" }
nova-db = { path = "../nova-db" }
nova-fuzzy = { path = "../nova-fuzzy" }
nova-hir = { path = "../nova-hir" }
nova-remote-proto = { path = "../nova-remote-proto", features = ["tokio"] }
nova-remote-rpc = { path = "../nova-remote-rpc" }
nova-scheduler = { path = "../nova-scheduler" }

# tokio-rustls defaults to the aws-lc-rs crypto provider, but other transitive dependencies (e.g.
# `ureq`) use the ring provider. rustls 0.23+ requires selecting *exactly one* provider, so we opt
# into ring across the workspace feature graph here.
tokio-rustls = { version = "0.26.0", default-features = false, features = ["ring", "logging", "tls12"], optional = true }
rustls = { version = "0.23.18", default-features = false, features = ["std", "ring"], optional = true }
rustls-pemfile = { version = "2.2.0", optional = true }
sha2 = { version = "0.10.9", optional = true }
hex = { version = "0.4.3", optional = true }

[target.'cfg(unix)'.dependencies]
libc = "0.2"

[target.'cfg(windows)'.dependencies]
windows-sys = { version = "0.61", features = ["Win32_Foundation", "Win32_Security", "Win32_Security_Authorization", "Win32_Storage_FileSystem", "Win32_System_Memory", "Win32_System_Pipes"] }

[dev-dependencies]
rcgen = "0.13.2"
tempfile.workspace = true
tokio.workspace = true
tracing-subscriber.workspace = true

[[bin]]
name = "nova-router-test-worker"
path = "tests/fixtures/test_worker.rs"
